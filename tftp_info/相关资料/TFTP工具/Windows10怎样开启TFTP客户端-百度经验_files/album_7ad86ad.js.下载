define("common-jquery:widget/js/ui/album/album.js",function(t,e,r){var i=t("common-jquery:widget/lib/jquery/jquery.js"),a=(t("common-jquery:widget/js/ui/dialog/dialog.js"),t("common-jquery:widget/js/util/event/event.js"),{init:function(t,e,r,a){try{var n=this;if(n.curId=0,n.currentIndex=0,n.totalImg=0,n.rpp=5,n.currentPage=-1,n.totalPage=0,n.pics=[],n.albumLogOption={},n.isManual,n.hasDownUrl,n.downUrl,n.nextSeries,n.instance,n.adjustBottomHeight,e.amount<1)return;if(n.curId=a,n.currentIndex=t,n.pics=e.stepPic,n.totalImg=n.pics.length,n.totalPage=Math.ceil(n.totalImg/n.rpp),i("#album-box-layer"+n.curId).length&&"hidden"===i("#album-box-layer"+n.curId).attr("hasshown"))return n.showAlbum(t),!1;n.imgList=[],n.render(r,a),n.bindEvent(),n.gotoCurrentImg(n.currentIndex)}catch(o){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:62})}},render:function(t){var e=this;t=i.extend({isManual:F.context("isManual"),hasDownUrl:F.context("hasDownUrl"),nextSeries:F.context("nextSeries")},t||{}),e.isManual=t.isManual,e.hasDownUrl=t.hasDownUrl,e.downUrl=F.context("downUrl"),e.nextSeries=t.nextSeries,e.adjustBottomHeight=e.isManual?40:66,e.build(),e.setLayout()},gotoCurrentImg:function(t){var e=this;e.currentIndex=t;var r=i("#currentAlbumImg"+e.curId),a=new Image,n=e.imgList[e.curId][t];a.onload=function(){n.hasAttribute("loaded")||(n.setAttribute("_width",parseInt(a.width)),n.setAttribute("_height",parseInt(a.height)),n.setAttribute("loaded",1)),i(r).attr("src",a.src),a.onload=null,a=null,e.adjustImg()},a.src=n.src;var o=i("#album-box-bottom"+e.curId).find(".current");o.length&&i(o).removeClass("current"),i(n).addClass("current"),i("#first-last-tip"+e.curId).length&&i("#first-last-tip"+e.curId).remove();var s=Math.floor(e.currentIndex/e.rpp)+1;if(e.currentPage!==s){e.currentPage=s;for(var c=0;c<e.totalImg;c++)i(e.imgList[e.curId]).hide();var d=(e.currentPage-1)*e.rpp,l=Math.min(d+e.rpp,e.totalImg);for(c=d;l>c;c++)i(e.imgList[e.curId]).eq(c).show()}e.isManual&&i("#m-pager").val(e.currentIndex+1)},build:function(){var t=this,e='<div id="album-box-layer'+t.curId+'" class="album-box-layer" hasShown="shown"></div>',r=[],a=385;t.totalImg<5&&(a=77*t.totalImg);for(var n=0;n<t.totalImg;n++)r.push('<img src="'+t.pics[n].src+'" />');if(t.isManual){if(t.hasDownUrl)var o='<a class="manual-download" href="'+t.downUrl+'" target="_blank">下载</a>';else var o="";e+='<div id="album-box'+t.curId+'" class="album-box"><a class="close-btn" title="关闭相册"></a><div id="album-box-content'+t.curId+'" class="album-box-content"><div class="img-wrap"><div id="img-scroll'+t.curId+'"><img id="currentAlbumImg'+t.curId+'" src="'+t.pics[t.currentIndex].src+'" /></div></div></div><div id="left-area'+t.curId+'" class="left-area"></div><div id="right-area'+t.curId+'" class="right-area"></div><div id="album-box-bottom'+t.curId+'" class="album-box-bottom manual-box"><div class="album-playlist-container" id="album-playlist-container'+t.curId+'" style="width:'+a+'px;display:none;"><div class="album-playlist">'+r.join("")+'</div></div><div class="manual-box-wrap clearfix">'+o+'<div class="manual-zoom"><b class="manual-zoom-lager"></b><b class="manual-zoom-smaller"></b></div><div class="manual-pager"><div class="m-p-inner"><span><input id="m-pager" value="'+t.currentIndex+'1"></span><span class="m-p-i">/</span>'+t.totalImg+"</div></div></div></div></div>"}else e+='<div id="album-box'+t.curId+'" class="album-box"><a class="close-btn" title="关闭相册"></a><div id="album-box-content'+t.curId+'" class="album-box-content"><img id="currentAlbumImg'+t.curId+'" src="'+t.pics[t.currentIndex].src+'" /></div><div id="left-area'+t.curId+'" class="left-area"></div><div id="right-area'+t.curId+'" class="right-area"></div><div id="album-box-bottom'+t.curId+'" class="album-box-bottom"><div class="album-playlist-container" id="album-playlist-container'+t.curId+'" style="width:'+a+'px"><div class="album-playlist">'+r.join("")+"</div></div></div></div>";i("body").append(e),t.imgList[t.curId]=i("#album-box-bottom"+t.curId+" img")},setLayout:function(){var t=this,e=i(window).height(),r=i(document).scrollTop();if(contentHeight=e-t.adjustBottomHeight,i("body").css("overflow","hidden"),i("#album-box"+t.curId).css("top",r),t.adjustImg(),t.isManual){var a=i("#currentAlbumImg"+t.curId).width(),n=890>a?a:890,o=i(window).width();i("#left-area"+t.curId).css({width:(o-n)/2,height:contentHeight}),i("#right-area"+t.curId).css({width:(o-n)/2,height:contentHeight}),i("#album-box-content"+t.curId).css({height:contentHeight})}else i("#left-area"+t.curId).css({width:"50%",height:contentHeight}),i("#right-area"+t.curId).css({width:"50%",height:contentHeight})},adjustImg:function(){var t=this,e=t.imgList[t.curId];if(e[t.currentIndex].hasAttribute("loaded")){t.instance&&(t.instance.dispose(),t.instance=null);var r=i(window).height()-t.adjustBottomHeight,a=i("#currentAlbumImg"+t.curId),n=i("#album-box-content"+t.curId).find(".img-wrap"),o=i(e[t.currentIndex]).attr("_height"),s=i(e[t.currentIndex]).attr("_width"),c=(r-o)/2;if(t.isManual&&(r=i(window).height(),n.css("margin-left",i(window).width()/2-450)),i(a).css("margin-top",0>c?0:c),t.isManual){var d=parseInt(o/s*890);if(d>r)i("#img-scroll"+t.curId).css({width:890,height:r+5,overflow:"hidden"}),i(a).css("width",890),i(n).css({width:890,marginTop:0,backgroundColor:"#fff"});else{var l=(i(window).height()-d-t.adjustBottomHeight)/2;i(a).css("width",890),i(n).css({width:890,marginTop:l,backgroundColor:"transparent"})}}else o>r?i(a).css({width:r/o*s,height:"auto"}):(i(a).css({width:s,height:o}),i("#album-box-content"+t.curId).css("text-align","center"))}},bindEvent:function(){var t=this;if(i.each(t.imgList[t.curId],function(e,r){i(r).attr("src");i(r).on("click",function(){try{"current"!==i(r).attr("class")&&t.gotoCurrentImg(e)}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:330})}})}),i("#left-area"+t.curId).on("click",function(e){try{if(e.stopPropagation(),t.currentIndex>0)t.gotoCurrentImg(t.currentIndex-1);else if(!i("#first-last-tip"+t.curId).length){var r='<div id="first-last-tip'+t.curId+'" class="first-last-tip first-tip"></div>';i("#album-box"+t.curId).prepend(r),i("#first-last-tip"+t.curId).css({top:(i(window).height()-t.adjustBottomHeight)/2-25,left:i(window).width()/2-90})}}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:348})}}),i("#right-area"+t.curId).on("click",function(e){try{if(e.stopPropagation(),t.currentIndex<t.totalImg-1)t.gotoCurrentImg(t.currentIndex+1);else if(!i("#first-last-tip"+t.curId).length){if(t.nextSeries){var r='<div id="first-last-tip'+t.curId+'" class="first-last-tip next-series">该系列经验的 <a href="/article/'+t.nextSeries+'.html">下一篇</a></div>';i("#album-box"+t.curId).prepend(r)}else{var r='<div id="first-last-tip'+t.curId+'" class="first-last-tip last-tip"></div>';i("#album-box"+t.curId).prepend(r)}i("#first-last-tip"+t.curId).css({top:(i(window).height()-t.adjustBottomHeight)/2-25,left:i(window).width()/2-90})}}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:371})}}),i(document).on("keydown",function(e){e.stopPropagation(),27===e.keyCode&&t.hideAlbum(t.curId)}),i("#album-box"+t.curId).find(".close-btn").on("click",function(){try{t.hideAlbum(t.curId)}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:383})}}),i(window).on("resize",function(){t.setLayout()}),t.isManual){for(var e=i(".manual-download"),r=i(".manual-zoom-lager"),a=i(".manual-zoom-smaller"),n=i("#m-pager"),o=[e,r,a],s=0;s<o.length;s++)o[s]&&o[s].on("mouseover",function(){i(this).addClass("bg-hover")}),o[s]&&o[s].on("mouseout",function(){i(this).removeClass("bg-hover")});i(a).on("click",function(){try{t.setSmaller()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:407})}}),i(r).on("click",function(){try{t.setLarger()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:410})}}),i(n).on("mouseover",function(){i(n).addClass("border-hover")}).on("mouseout",function(){i(n).removeClass("border-hover")}).on("click",function(){try{i(n).css("border","1px solid #e1e1e1")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common-jquery:widget/js/ui/album/album.js",method:"",ln:417})}}).on("blur",function(){i(n).css("border","")}).on("keydown",function(e){if(e.stopPropagation(),13===e.keyCode){var r=parseInt(n.val());if(1>r||r>t.totalImg||isNaN(r))return void alert("请输入合法页码");t.gotoCurrentImg(r-1)}}),i(document).on("keydown",function(e){e.stopPropagation(),37===e.keyCode&&i("#left-area"+t.curId).trigger("click"),39===e.keyCode&&i("#right-area"+t.curId).trigger("click")})}},hideAlbum:function(){var t=this;i("#album-box-layer"+t.curId).hide(),i("#album-box"+t.curId).hide(),i("#album-box-layer"+t.curId).attr("hasShown","hidden"),i("body").css("overflow","auto"),i(window).off("resize")},showAlbum:function(t){var e=this;e.imgList[e.curId]=i("#album-box-bottom"+e.curId+" img"),i("#album-box-layer"+e.curId).show(),e.gotoCurrentImg(t),i("#album-box"+e.curId).show(),e.setLayout(),i("#album-box-layer"+e.curId).attr("hasShown","shown")},setSmaller:function(){var t=this;if(t.instance){var e=parseInt(i("#currentAlbumImg"+t.curId).width()),r=parseInt(i("#currentAlbumImg"+t.curId).height()),a=parseInt(e-100),n=parseInt(r-100),o=i(window).height();o>n&&(n=o,a=parseInt(e/r*n),i("#scrollbar-y-slider-thumb").length&&i("#scrollbar-y-slider-thumb").hide()),i("#currentAlbumImg"+t.curId).css("width",a),i("#img-wrap").find("#currentAlbumImg"+t.curId).css("width",a),i("#img-wrap").find("#currentAlbumImg"+t.curId).css("width",a),i("#img-scroll"+t.curId).length&&i("#img-scroll"+t.curId).css("width",a);var s=(i(window).width()-a)/2;i("#img-wrap").find("#album-box-content"+t.curId).css("margin-left",s)}},setLarger:function(){var t=this;if(t.instance){var e=parseInt(i("#currentAlbumImg"+t.curId).width()),r=parseInt(e+100);i("#scrollbar-y-slider-thumb").length&&i("#scrollbar-y-slider-thumb").show(),r>890&&(r=890),i("#currentAlbumImg"+t.curId).css("width",r),i("#img-wrap").find("#album-box-content"+t.curId).css("width",r),i("#img-scroll"+t.curId).length&&i("#img-scroll"+t.curId).css("width",r-9);var a=(i(window).width()-imgWidthSmaller)/2-5;i("#img-wrap").find("#album-box-content"+t.curId).css("margin-left",a)}}});r.exports=a});