define("article:widget/like/like.js",function(e,t,i){var n=e("common-jquery:widget/lib/jquery/jquery.js");e("common-jquery:widget/lib/jquery.plugins/browser.js"),e("common-jquery:widget/lib/jquery.plugins/string.js");var o=e("common-jquery:widget/js/logic/log/log.js"),l=e("common-jquery:widget/js/util/event/event.js"),a=e("article:widget/left-promo/left-promo.js"),s=e("common-jquery:widget/js/ui/dialog/dialog.js");e("common-jquery:widget/js/logic/login/login.js");var c={WIDTH:43,HEIGHT:288,hasSubmit:0,relateExpStartIndex:0,resetStyle:function(){var e=this,t=n(".prompt"),i=n(window).height(),o=.95*(i-e.HEIGHT),l=t.offset(),a=n("#wgt-like");a.css({top:o,display:"block",left:l.left-e.WIDTH-10})},init:function(){var e=this;if(!n.browser.ie||n.browser.ie>7)e.resetStyle(),n(window).on("resize",function(){e.resetStyle()});else{var t=n(".prompt"),i=t.offset(),o=n("#wgt-like");o.css({display:"block",left:i.left-e.WIDTH-10})}e.eventHandler()},truncate:function(e,t,i){i=i?i:"...";var o=e;return n.string.getByteLength(e)>2*t&&(o=n.string.subByte(e,2*t,i)),o},renderRelateList:function(){var e=this,t=[];F.context("relateExp")?n.each(F.context("relateExp").list,function(i,n){i>=e.relateExpStartIndex&&i<e.relateExpStartIndex+5&&t.push(["<li>","<i></i>",'<a href="/article/'+n.eidEnc+'.html" target="_blank">',e.truncate(n.title,9),"</a>","</li>"].join(""))}):t.push(["<li>",'<p class="no-relate-list">暂无推荐</p>',"</li>"].join("")),n("#dislike-relate-list").html(t.join("")),n.each(n(".dislike-content a"),function(e,t){n(t).off("click"),n(t).on("click",function(){o.send(location.href,2019,{page:"article",pos:"dislike_content"})})})},eventHandler:function(){var e=this,t=n("#like-btn"),i=n("#like-num"),a=n("#like-icon"),c=n("#like-animation"),r=n("#dislike-btn");t.on("click",function(e){e.preventDefault();var d=+F.context("likeStatus"),u=1,f="none";1===d?u=5:f=["url(https://exp-picture.cdn.bcebos.com/023cff37c97622bc38c7e8d1a05fd54605962858.jpg?t=",(new Date).getTime(),") 0% 0% / contain"].join(""),l.fire("login.check",{isLogin:function(){n.ajax({url:"/user/submit/thumb",type:"post",dataType:"json",data:{method:"feedback",eidEnc:F.context("eid"),BdStoken:F.context("BdStoken"),bdstt:F.context("bdstt"),type:u},success:function(e){if(0===e.errno){if(1===u){r.removeClass("active"),a.removeClass("like-icon"),c.css("background",f);var l=n("#tpl-like").html();n("#like-feedback").removeClass("hide"),n("#feedback-content").html(l);var d=i.html();9999>d&&i.html(parseInt(d,10)+1),i.addClass("active"),F.context("likeStatus",1),o.send(location.href,2019,{pos:"like",action:"click",isCancel:0})}else if(5===u){F.context("likeStatus",3),t.removeClass("active"),a.addClass("like-icon"),c.css("background","none"),n("#like-feedback").addClass("hide");var d=i.html();9999>d&&d>0&&i.html(parseInt(d,10)-1),i.removeClass("active"),o.send(location.href,2019,{pos:"like",action:"click",isCancel:1})}}else{var k="系统错误，请稍后重试";switch(e.errno){case 2001:k="您已经评价过了 :)";break;case 2041:k="您不能评价自己的经验噢~"}s.alert(k)}},error:function(){s.alert("网络错误，请稍后重试")}})},notLogin:function(){l.fire("login.log")}})}),r.on("click",function(d){d.preventDefault();var u=+F.context("likeStatus"),f=2;2===u&&(f=5),l.fire("login.check",{isLogin:function(){n.ajax({url:"/user/submit/thumb",type:"post",dataType:"json",data:{method:"feedback",eidEnc:F.context("eid"),BdStoken:F.context("BdStoken"),bdstt:F.context("bdstt"),type:f},success:function(l){if(0===l.errno)if(2===f){var d=+F.context("likeStatus"),u=n("#like-num").html();1===+d&&9999>u&&u>0&&n("#like-num").html(parseInt(u,10)-1);var d=+F.context("likeStatus");if(r.addClass("active"),t.removeClass("active"),i.removeClass("active"),a.addClass("like-icon"),c.css("background","none"),F.context("relateExp")){var k="";F.context("relateExp").count>4&&(k='<a href="#" id="change-list" class="change-list">换一批</a>')}var p=['<div class="dislike-content">',"<h1>很遗憾这篇经验<br/>没有解决您的问题！</h1>","<p>看看其他经验能否帮到您：</p>",'<ul id="dislike-relate-list"></ul>',k,"</div>"].join("");n("#like-feedback").removeClass("hide"),n("#feedback-content").html(p),e.renderRelateList(),F.context("relateExp")&&n("#change-list").on("click",function(t){t.preventDefault(),e.relateExpStartIndex=0===e.relateExpStartIndex?5:0,e.renderRelateList()}),F.context("likeStatus",2),o.send(location.href,2019,{pos:"dislike",action:"click",isCancel:0})}else 5===f&&(F.context("likeStatus",3),r.removeClass("active"),n("#like-feedback").addClass("hide"),o.send(location.href,2019,{pos:"dislike",action:"click",isCancel:1}));else{var m="系统错误，请稍后重试";switch(l.errno){case 2001:m="您已经评价过了 :)";break;case 2041:m="您不能评价自己的经验噢~"}s.alert(m)}},error:function(){s.alert("网络错误，请稍后重试")}})},notLogin:function(){l.fire("login.log")}})}),n("#close-like-tip").on("click",function(e){e.preventDefault(),n("#like-feedback").addClass("hide")})}};l.on("like.show",function(){var e=0;n(".aside-pro-container").length&&(e=n(".aside-pro-container").offset().top);var t=n(".prompt").length?n(".prompt").offset().top:0,i=Math.min(e,t),o=n("#wgt-like");n(window).scrollTop()>i&&"none"===o.css("display")&&(c.init(),a.init())}),i.exports=c});