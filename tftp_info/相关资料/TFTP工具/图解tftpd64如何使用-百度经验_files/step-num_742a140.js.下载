define("article:widget/ui/step-num/step-num.js",function(e,t,i){var n=e("common-jquery:widget/lib/tangram/base/base.js"),o=e("common-jquery:widget/js/util/event/event.js"),s=e("common-jquery:widget/lib/jquery/jquery.js"),r={wrapper:"format-exp",listIcons:null,stepIcons:[],iLen:0,currentSectionIndex:0,isOrder:1,container:null,containerWidth:32,iconHeight:0,topGap:70,endDivGap:20,scrollTo:function(e){for(var t=n.page.getScrollTop(),i=10,o=1;10>=o;o++)void function(e,t,i,n){setTimeout(function(){document.documentElement.scrollTop=document.body.scrollTop=t+(i-t)/n*e},16*e)}(o,t,e,i)},clickScroll:function(e){for(var t,i=0;i<this.sectionNum&&(t=n.array.lastIndexOf(this.sectionContent[i].stepIcons,e),!(t>-1));i++);if(-1===t)throw new Error("Hey,there must be something wrong...");var o=this.sectionContent[i].listIcons[t],s=n.dom.getPosition(o);this.scrollTo(s.top-this.topGap)},fixPosition:function(){var e=n.dom.getPosition(this.sectionContent[0].listIcons[0]),t=this.topGap;n.dom.fixable(this.container,{vertival:"top",horizontal:"left",offset:{x:e.left,y:t},autofix:!0})},_init:function(){var e=document.createElement("div"),t=n.q("last-item",this.wrapper,"div"),i=t.length,r=[],l={isOrder:0,isUnOrder:0},c=6===n.browser.ie;if(e.id="exp-step-nav",0!==t.length){for(var d=0;i>d;d++){var a,p=n.dom.getAncestorByClass(t[d],"exp-conent-orderlist");p?(a={isOrder:1,iconHeight:34,klass:"list-icon",tag:"div"},l.isOrder=1):(p=n.dom.getAncestorByClass(t[d],"exp-content-unorderlist"),a={isOrder:0,iconHeight:13,klass:"exp-content-list",tag:"li"},l.isUnOrder=1);var u=s([a.tag,".",a.klass].join("")).filter(":visible"),h=u.length;a.listIcons=u,a.stepIcons=[],a.lastItem=t[d];var m=document.createElement("div");m.className=a.isOrder?"order-ico-group":"unorder-ico-group",m.id="ico-group-"+d;for(var v=0;h>v;v++){var f=document.createElement("a"),g=a.isOrder?u[v].innerHTML:v+1;f.className="list-icon-link",f.style.display="none",c&&(f.href="javascript:void(0);"),f.setAttribute("title","点击返回第"+g+"步"),a.isOrder&&f.appendChild(document.createTextNode(g)),m.appendChild(f),a.stepIcons.push(f)}r.push(a),e.appendChild(m)}l.isOrder&&l.isUnOrder&&(e.className=r[0].isOrder?"complex-order-first":"complex-unorder-first"),n.dom.setStyles(e,{width:this.containerWidth}),this.sectionContent=r,this.container=e,this.sectionNum=i,this.pageWidth=n.page.getWidth(),this.ltIe7=n.browser.ie&&n.browser.ie<8,e.style.visibility="hidden",document.body.appendChild(e);var b=this;b.setIconVisibility(),b.fixPosition(),e.style.visibility="visible",n.on(window,"scroll",function(){b.setIconVisibility(),o.fire("scrollTip.close")}),n.on(window,"resize",function(){if(b.ltIe7){var e=n.page.getWidth();if(n.g("exp-step-nav").style.visibility="hidden",e>document.documentElement.offsetWidth)return void clearTimeout(b.timer);if(b.pageWidth===e)return void(n.g("exp-step-nav").style.visibility="visible");b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){b.fixPosition(),n.g("exp-step-nav").style.visibility="visible",b.timer=null,delete b.timer},1e3),b.pageWidth=n.page.getWidth()}else b.fixPosition()}),n.on(e,"click",function(e){var t=n.event.getTarget(e);b.clickScroll(t)})}},getVisibleInfo:function(){for(var e=n.page.getScrollTop(),t=this.sectionNum,i=0,o=this.topGap,s={currentSectionIndex:0,currentStepIndex:0,visibleStepNum:0};t>i;i++){var r=this.sectionContent[i],l=r.listIcons,c=l.length,d=0;for(s.currentSectionIndex=i;c>d;d++){var a=n.dom.getPosition(l[d]).top;if(a-o>e+Math.min(d,10)*r.iconHeight)return d||(s.currentSectionIndex=-1),s.currentStepIndex=d-1,s}var p=n.dom.getPosition(r.lastItem).top;if(e+r.iconHeight*Math.min(c,10)<p)return s.currentStepIndex=c-1,s;if(p>e){var u=p-e-this.endDivGap-this.topGap,h=Math.floor(u/r.iconHeight);if(h=Math.min(c,10,h),h>0)return s.currentStepIndex=c-1,s.visibleStepNum=h,s}}return s={currentSectionIndex:-1}},setItemVisible:function(e,t,i){i?e.style.visibility=t?"visible":"hidden":e.style.backgroundPosition=t?"0 8px":"-1000px 8px"},setIconVisibility:function(){for(var e=this.getVisibleInfo(),t=e.currentSectionIndex,i=e.currentStepIndex,o=e.visibleStepNum,r=0;r<this.sectionNum;r++)if(n.g("ico-group-"+r).style.display=r===t?"block":"none",-1===t){for(var l=this.sectionContent[r].listIcons,c=this.sectionContent[r].isOrder,d=0,a=l.length;a>d;d++)this.setItemVisible(l[d],1,c);if(this.sectionNum-1===r)return}var p=this.sectionContent[t],u=p.stepIcons,h=u.length,c=p.isOrder,m=p.listIcons;if(10>i){for(var r=0;i>=r;r++)n.dom.show(u[r]),this.setItemVisible(m[r],0,c);for(var r=i+1;h>r;r++)n.dom.hide(u[r]),this.setItemVisible(m[r],1,c)}else{for(var v=i-10,r=0;v>=r;r++)n.dom.hide(u[r]),this.setItemVisible(m[r],1,c);for(var r=i+1;h>r;r++)n.dom.hide(u[r]),this.setItemVisible(m[r],1,c);for(var r=v+1;i>=r;r++)n.dom.show(u[r]),this.setItemVisible(m[r],0,c)}var f=s(".read-whole-mask").css("display");n.g("exp-step-nav").style.visibility="none"!==f?"hidden":"visible";var g=n.q("list-icon-current",this.container)[0],b=u[i];if(b!=g&&(g&&n.dom.removeClass(g,"list-icon-current"),n.dom.addClass(b,"list-icon-current")),o)for(var r=0;i-o>=r;r++)n.dom.hide(u[r])},init:function(){var e=this;setTimeout(function(){e._init()},1500)}};i.exports=r});