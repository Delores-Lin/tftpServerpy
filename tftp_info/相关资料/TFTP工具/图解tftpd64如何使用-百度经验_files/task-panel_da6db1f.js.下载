define("common-jquery:widget/task-panel/task-panel.js",function(require,exports,module){var $=require("common-jquery:widget/lib/jquery/jquery.js"),ec=require("common-jquery:widget/js/util/event/event.js"),nslog=require("common-jquery:widget/js/logic/log/log.js");require("common-jquery:widget/js/logic/login/login.js");var $taskPanelEntrance=$(".task-panel-entrance"),$taskPanelWrap=$("#task-panel-wrap"),$taskPanelList=$(".task-panel-list"),$pageMask=$(".page-mask"),$taskWrap=$("#task-panel-task-wrap"),$taskContent=$(".task-content"),$taskMessage=$(".task-message"),$moneyWealth=$(".money-wealth"),$moneyCash=$(".money-cash"),$taskPanel=$(".task-panel"),$moneyAction=$(".money-action"),$body=$("body"),$triggerClick=$("#task-panel-trigger-click"),taskTpl=function render(data){"use strict";var keyArr=[],valArr=[];data=data||{},data.__encodeHTML__=window.template.__encodeHTML;for(var key in data)keyArr.push('"'+key+'"'),valArr.push(data[key]);var source="new Function("+keyArr.join(",")+', "\\"use strict\\";var __code__ = \\"\\";;__code__ += (\\"<div class=\\\\\\"single-task-content \\");if (task.name === \'签到\') {;__code__ += (\\"signin-content\\");};__code__ += (\\"\\\\\\">     <div class=\\\\\\"task-info\\\\\\">         <div class=\\\\\\"task-name\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.name) === \\"undefined\\" ? \\"\\" : task.name));__code__ += (\\"</div>         <div class=\\\\\\"task-desc\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.desc) === \\"undefined\\" ? \\"\\" : task.desc));__code__ += (\\"</div>         <div class=\\\\\\"task-reward\\\\\\">             \\");if (task.wealth) {;__code__ += (\\"                 <div class=\\\\\\"reward-money\\\\\\">+\\");__code__ += (__encodeHTML__(typeof (task.wealth) === \\"undefined\\" ? \\"\\" : task.wealth));__code__ += (\\"财富值</div>             \\");};__code__ += (\\"             \\");if (task.cash) {;__code__ += (\\"                 <div class=\\\\\\"reward-cash\\\\\\">+\\");__code__ += (__encodeHTML__(typeof (task.cash) === \\"undefined\\" ? \\"\\" : task.cash));__code__ += (\\"现金红包</div>             \\");};__code__ += (\\"         </div>     </div>     <div class=\\\\\\"task-status\\");if (showProgress) {;__code__ += (\\" task-status-progress\\");};__code__ += (\\"\\\\\\">         \\");if (showProgress) {;__code__ += (\\"             <div class=\\\\\\"task-action task-action-progress\\\\\\">                 <div class=\\\\\\"progress-bar-done\\\\\\" style=\\\\\\"width: \\");__code__ += (__encodeHTML__(typeof (task.finishNum * 100 / task.stepNum) === \\"undefined\\" ? \\"\\" : task.finishNum * 100 / task.stepNum));__code__ += (\\"%\\\\\\">                 </div>                 <div class=\\\\\\"task-progress\\\\\\">已完成                     <div class=\\\\\\"task-done\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.finishNum) === \\"undefined\\" ? \\"\\" : task.finishNum));__code__ += (\\"</div>/<div class=\\\\\\"task-total\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.stepNum) === \\"undefined\\" ? \\"\\" : task.stepNum));__code__ += (\\"</div>                 </div>             </div>         \\");} else {;__code__ += (\\"             <div class=\\\\\\"task-action task-action-normal \\");__code__ += (__encodeHTML__(typeof (task.actionClassName) === \\"undefined\\" ? \\"\\" : task.actionClassName));__code__ += (\\"\\\\\\"             data-status=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (task.status) === \\"undefined\\" ? \\"\\" : task.status));__code__ += (\\"\\\\\\"             data-jump=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (task.jump) === \\"undefined\\" ? \\"\\" : task.jump));__code__ += (\\"\\\\\\"             data-name=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (task.name) === \\"undefined\\" ? \\"\\" : task.name));__code__ += (\\"\\\\\\"             data-tid=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (task.tid) === \\"undefined\\" ? \\"\\" : task.tid));__code__ += (\\"\\\\\\"             data-wealth=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (task.wealth) === \\"undefined\\" ? \\"\\" : task.wealth));__code__ += (\\"\\\\\\"             data-cash=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (task.cash) === \\"undefined\\" ? \\"\\" : task.cash));__code__ += (\\"\\\\\\"             data-type=\\\\\\"\\");__code__ += (__encodeHTML__(typeof (type) === \\"undefined\\" ? \\"\\" : type));__code__ += (\\"\\\\\\">                 <span class=\\\\\\"action-name\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.actionName) === \\"undefined\\" ? \\"\\" : task.actionName));__code__ += (\\"</span>                 <div class=\\\\\\"task-progress\\\\\\">已完成                     <div class=\\\\\\"task-done\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.finishNum) === \\"undefined\\" ? \\"\\" : task.finishNum));__code__ += (\\"</div>/<div class=\\\\\\"task-total\\\\\\">\\");__code__ += (__encodeHTML__(typeof (task.stepNum) === \\"undefined\\" ? \\"\\" : task.stepNum));__code__ += (\\"</div>                 </div>             </div>         \\");};__code__ += (\\"     </div> </div> \\");return __code__")';try{var fn=eval(source),html=fn.apply(null,valArr)}catch(e){return e.name="RenderError",e.tpl="common-jquery:widget/task-panel/task.tmpl",window.template.__handelError(e),"template.js error"}return html},taslListTpl=function render(data){"use strict";var keyArr=[],valArr=[];data=data||{},data.__encodeHTML__=window.template.__encodeHTML;for(var key in data)keyArr.push('"'+key+'"'),valArr.push(data[key]);var source="new Function("+keyArr.join(",")+', "\\"use strict\\";var __code__ = \\"\\";;__code__ += (\\"<div class=\\\\\\"task-list\\\\\\">     <div class=\\\\\\"task-type\\\\\\">         \\");__code__ += (__encodeHTML__(typeof (type) === \\"undefined\\" ? \\"\\" : type));__code__ += (\\"         \\");if (typeTip) {;__code__ += (\\"             <div class=\\\\\\"task-question\\\\\\">                 <div class=\\\\\\"task-tip\\\\\\">                     <div class=\\\\\\"triangle\\\\\\"></div>                     <div class=\\\\\\"tip-text\\\\\\">\\");__code__ += (__encodeHTML__(typeof (typeTip) === \\"undefined\\" ? \\"\\" : typeTip));__code__ += (\\"</div>                 </div>             </div>         \\");};__code__ += (\\"     </div>     \\");__code__ += (typeof (taskListStr) === \\"undefined\\" ? \\"\\" : taskListStr);__code__ += (\\" </div>\\");return __code__")';try{var fn=eval(source),html=fn.apply(null,valArr)}catch(e){return e.name="RenderError",e.tpl="common-jquery:widget/task-panel/task-list.tmpl",window.template.__handelError(e),"template.js error"}return html},scrollbarwidth=window.innerWidth-document.body.clientWidth,entranceOpenRight=Math.max(.159*document.body.clientWidth,350)+scrollbarwidth,entranceCloseRight=0,isEntranceOpen=!1,scrollToSignInFlag=window.location.search.indexOf("10th_task_type=sign")>=0?!0:!1,openTaskPanelFlag=window.location.search.indexOf("openTaskPanel=1")>=0,gainRewardPendingTid={},actionStatus=[{name:"去做任务","class":"go-to-task"},{name:"领取奖励","class":"gain-reward"},{name:"已完成","class":"action-done"}],moneyJump={goods:"https://jingyan.baidu.com/shop/category",cash:"https://jingyan.baidu.com/user/nuc/income"},specialType={"日常任务":"任务每日重置；优质经验以提交后首次审核获得优质标签为准，悬赏经验要符合悬赏标准才算完成哦~","成就任务":"任务完成次数不限；累计优质经验以提交后首次审核获得优质标签来累计，累计悬赏任务要符合悬赏标准才可以累计哦~"},specialAction={"签到":"/utask/submit/signin","了解经验":"/utask/submit/knowexp","经验搜索":"/utask/submit/searchexp"},progressBarNames=["当日全勤","本周满签"],taskPanel={init:function(e){try{this.triggerFrom=e,this.setPanelRight(-entranceOpenRight),this.eventHandler(),(scrollToSignInFlag||openTaskPanelFlag)&&this.triggerOpenTaskPanel()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:74})}},eventHandler:function(){var e=this;$taskPanelWrap.on("click",".task-panel-entrance",function(t){try{isEntranceOpen?(nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-entrance",action:"click",isTaskListshow:!0,isLogin:F.context("isLogin")}),e.setEntranceClose()):(nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-entrance",action:"click",isTaskListshow:!1,isLogin:F.context("isLogin")}),e.triggerOpenTaskPanel())}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:100})}}).on("click",".page-mask",function(t){try{nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-mask",action:"click",isLogin:F.context("isLogin")}),e.setEntranceClose()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:109})}}).on("click",".task-action-normal",function(t){try{var a=$(t.currentTarget),s=a.data("status"),n=a.data("jump"),o=a.data("name"),i=a.data("tid"),c=a.data("type"),d=a.data("wealth")||0,_=a.data("cash")||0;switch(nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"pc-task-panel-action",action:"click",taskName:o,status:s,isLogin:F.context("isLogin")}),s){case 0:F.context("isLogin")?e.goToTask(n,o,i):ec.fire("login.log");break;case 1:e.gainReward(i,c,d,_)}}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:140})}}).on("click",".money-action",function(t){try{var a=$(t.currentTarget),s=a.data("type");nslog.send(location.href,2019,{module:"common",page:e.triggerFrom,pos:"task-panel-money-item",action:"click",type:s,isLogin:F.context("isLogin")}),F.context("isLogin")?e.jumpToUrl(moneyJump[s]):ec.fire("login.log")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message,path:"common-jquery:widget/task-panel/task-panel.js",method:"",ln:156})}}).on("mouseenter mouseleave",".task-question",function(e){var t=$(e.currentTarget),a=t.children(".task-tip");"mouseenter"===e.type?a.addClass("task-tip-show"):a.removeClass("task-tip-show")})},triggerOpenTaskPanel:function(){this.showMessage("数据加载中..."),this.setEntranceOpen(),this.getPanelData()},gainReward:function(e,t,a,s){var n=this;gainRewardPendingTid[e]||(gainRewardPendingTid[e]=1,$.ajax({url:"/utask/submit/getreward",method:"POST",dataType:"json",data:{tid:e,bdStoken:F.context("BdStoken"),bdstt:F.context("bdstt")},success:function(o){0===o.errCode?(nslog.send(location.href,2019,{module:"common",page:n.triggerFrom,pos:"task-panel-gain-reward",isLogin:F.context("isLogin"),wealth:a,cash:s}),n.getPanelData("成就任务"===t?e:"")):gainRewardPendingTid[e]=0},fail:function(){gainRewardPendingTid[e]=0}}))},goToTask:function(e,t,a){var s=this;specialAction[t]?$.ajax({url:specialAction[t],method:"POST",data:{tid:a,bdStoken:F.context("BdStoken"),bdstt:F.context("bdstt")},dataType:"json",success:function(t){0===t.errCode&&(e?s.jumpToUrl(e):s.getPanelData())}}):this.jumpToUrl(e)},jumpToUrl:function(e){$triggerClick.attr("href",e),$triggerClick[0].click()},setEntranceOpen:function(){$pageMask.addClass("page-mask-show"),$taskPanelList.css("visibility","visible"),this.setEntranceRight(entranceOpenRight),this.setPanelRight(0),isEntranceOpen=!0,$body.css("overflow","hidden")},setEntranceClose:function(){this.setEntranceRight(entranceCloseRight),this.setPanelRight(-entranceOpenRight),$pageMask.removeClass("page-mask-show"),$taskPanelList.css("visibility","hidden"),isEntranceOpen=!1,$body.css("overflow","scroll")},setEntranceRight:function(e){$taskPanelEntrance.css("right",e+"px")},setPanelRight:function(e){$taskPanel.css("right",e+"px")},showMessage:function(e){$taskContent.removeClass("task-content-show"),$taskPanel.addClass("task-panel-fixed-height"),$taskMessage.text(e),$taskMessage.addClass("task-message-show")},hideMessage:function(){$taskMessage.removeClass("task-message-show"),$taskPanel.removeClass("task-panel-fixed-height"),$taskContent.addClass("task-content-show")},getPanelData:function(e){var t=this;$.ajax({url:"/utask/ajax/task",method:"POST",data:{bdStoken:F.context("BdStoken"),bdstt:F.context("bdstt")},dataType:"json",success:function(a){if(0===a.errCode){var s=a.data.data;if(t.renderPanelData(s,e),t.hideMessage(),scrollToSignInFlag){var n=$(".single-task-content.signin-content").offset().top-60;$($taskPanelList).animate({scrollTop:n+"px"},800),scrollToSignInFlag=!1}}else t.showMessage("数据加载错误，请稍后再试~");gainRewardPendingTid={}}})},renderPanelData:function(e,t){var a=e.wealth||0,s=e.cash||0,n=e.freshTask||[],o=e.dailyTask||[],i=e.growupTask||[];$moneyWealth.text(F.context("isLogin")?a:"--"),$moneyCash.text(F.context("isLogin")?s:"--");var c=[{type:"新手任务",data:n},{type:"日常任务",data:o},{type:"成就任务",data:i}],d=this.genHtml(c,t);$taskWrap.empty().append(d)},genHtml:function(e,t){var a=this;return e.reduce(function(e,s){return e+a.genTaskHtml(s,t)},"")},genTaskHtml:function(e,t){var a=this;if(!e.data.length)return"";var s=e.data.reduce(function(s,n){return s+a.genTaskItemHtml(n,e.type,t)},""),n=taslListTpl({type:e.type,typeTip:specialType[e.type],taskListStr:s});return n},genTaskItemHtml:function(e,t,a){a&&a===e.tid&&(e.status=2);var s=0===e.status&&"签到"===e.name?"签到":actionStatus[e.status].name;e.actionName=s,e.actionClassName=actionStatus[e.status].class;var n=F.context("isLogin")&&0===e.status&&progressBarNames.indexOf(e.name)>-1,o=taskTpl({showProgress:n,task:e,type:t});return o}};module.exports=taskPanel});